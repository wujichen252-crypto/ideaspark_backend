## ğŸ”§ ä¸€ã€æ€»ä½“å¼€å‘çº¦å®š

| é¡¹          | è¯´æ˜                                                   |
| ----------- | ------------------------------------------------------ |
| é¡¹ç›®æ¶æ„    | ç®€åŒ–ä¸‰å±‚æ¶æ„ï¼šController + Service å®ç°ç±» + Repository |
| ORM æ¡†æ¶    | Spring Data JPAï¼ˆåŸºäº Hibernateï¼‰                      |
| JSON åºåˆ—åŒ– | é»˜è®¤ Jackson                                           |
| DTO æ˜ å°„    | ä¸ä½¿ç”¨ `BeanUtils.copyProperties`                      |
| æ¥å£é£æ ¼    | ç»Ÿä¸€ä½¿ç”¨ `ResponseEntity<?>` åŒ…è£… JSON æ ¼å¼å“åº”        |
| åˆ†é¡µæŸ¥è¯¢    | ä½¿ç”¨ `Pageable` å’Œ `Page<T>`                           |

------

## ğŸ§© äºŒã€åŒ…ç»“æ„è§„èŒƒ

```text
com.xxx.project
â”œâ”€â”€ controller          # æ§åˆ¶å™¨å±‚
â”œâ”€â”€ service             # ä¸šåŠ¡å®ç°å±‚ï¼ˆæ— æ¥å£ï¼‰
â”œâ”€â”€ repository          # DAO å±‚
â”œâ”€â”€ model
â”‚   â”œâ”€â”€ entity          # å®ä½“ç±»ï¼ˆä¸æ•°æ®åº“å­—æ®µæ˜ å°„ï¼‰
â”‚   â”œâ”€â”€ dto
â”‚   â”‚   â”œâ”€â”€ request     # æ¥æ”¶å‰ç«¯è¯·æ±‚å‚æ•°
â”‚   â”‚   â””â”€â”€ response    # è¿”å›å‰ç«¯çš„æ ¼å¼åŒ–å¯¹è±¡
â”œâ”€â”€ config              # é…ç½®ç±»
â”œâ”€â”€ util                # å·¥å…·ç±»
```

------

## ğŸ§­ ä¸‰ã€å‘½åè§„èŒƒ

### 1. Java å®ä½“ç±»å­—æ®µå

- ä½¿ç”¨é©¼å³°å‘½åï¼ˆå¦‚ï¼š`userId`, `createTime`ï¼‰
- åŠ ä¸Š `@Column(name="xxx")` æ˜ å°„æ•°æ®åº“å­—æ®µ

### 2. æ¥å£è·¯å¾„

- RESTful é£æ ¼ + åŠ¨è¯ï¼Œå¦‚ï¼š
  - `POST /api/user/register`
  - `GET /api/admin/getAllUsers`

------

## ğŸ§ª å››ã€æ§åˆ¶å™¨å±‚è§„èŒƒ

- ä½¿ç”¨ `@RestController` + `@RequestMapping("/api/xxx")`

- æ‰€æœ‰æ¥å£è¿”å›å€¼ç»Ÿä¸€ä½¿ç”¨ï¼š

  ```java
  return ResponseEntity.ok(Map.of(
      "status", 200,
      "message", "xxxæˆåŠŸ",
      "data", xxx
  ));
  ```

- å¤±è´¥è¿”å›ï¼š

  ```java
  return ResponseEntity.badRequest().body(Map.of(
      "status", 400,
      "message", "xxxå¤±è´¥ï¼š" + e.getMessage()
  ));
  ```

- è¯·æ±‚å‚æ•°ç»Ÿä¸€å°è£…ä¸º DTO è¯·æ±‚ç±»ï¼ˆå¦‚ï¼š`UserRequest`ï¼‰

------

## ğŸ§± äº”ã€Service å±‚è§„èŒƒ

- ä¸å®šä¹‰æ¥å£ï¼Œç›´æ¥ä½¿ç”¨ `@Service` çš„å®ç°ç±»
- æ‰€æœ‰æ•°æ®åº“é€»è¾‘ã€ä¸šåŠ¡æ ¡éªŒéƒ½å†™åœ¨è¿™é‡Œ
- å¼‚å¸¸ç»Ÿä¸€æŠ›å‡º `RuntimeException`ï¼ŒController ç»Ÿä¸€å¤„ç†è¿”å›

------

## ğŸ“¤ å…­ã€Request/Response è§„èŒƒ

### è¯·æ±‚ DTOï¼ˆRequestï¼‰

```java
@Data
public class UserRequest {
    private Integer page;
    private Integer size;
    private String name;
}
```

- å‘½åä¸º `XXXRequest`ï¼Œæ”¾åœ¨ `dto.request` åŒ…ä¸­

### å“åº” DTOï¼ˆResponseï¼‰

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class UserResponse {
    private Integer id;
    private String name;
    private String role; // ä¸­æ–‡ï¼šè¶…çº§ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·
    private String state; // ä¸­æ–‡ï¼šæ–°å»ºã€å·²æ¿€æ´»ã€å·²åˆ é™¤
}
```

- å‘½åä¸º `XXXResponse`ï¼Œæ”¾åœ¨ `dto.response` åŒ…ä¸­
- ä¸ Entity åˆ†ç¦»ï¼Œé¿å…æš´éœ²æ•°æ®åº“ç»“æ„

------

## ğŸ” ä¸ƒã€å­—æ®µè½¬æ¢è§„èŒƒ

- ç»Ÿä¸€åœ¨ Service å±‚ä¸­è¿›è¡Œ DTO â†’ Entity æ˜ å°„

- ä½¿ç”¨ï¼š

  ```java
  UserResponse dto = new UserResponse();
  dto.setId(user.getId());
  dto.setAccount(user.getAccount());
  dto.setUsername(user.getUsername());
  dto.setPhone(user.getPhone());
  dto.setCreateTime(user.getCreateTime());
  dto.setRole(roleToCn(user.getRole()));
  dto.setState(stateToCn(user.getState()));
  ```

  ## ğŸ§± å®ä½“å’Œå“åº”ç±»æ˜ å°„è§„èŒƒ

  - æ‰€æœ‰ `Entity â†’ DTO` çš„è½¬æ¢éƒ½é‡‡ç”¨**æ‰‹åŠ¨èµ‹å€¼**
  - å»ºè®®å°è£…åœ¨ `Service` å±‚çš„ç§æœ‰æ–¹æ³•ä¸­ç»Ÿä¸€å¤„ç†
  - å¦‚æœå­—æ®µå¤šï¼Œå¯ä½¿ç”¨ IDEA çš„å¿«æ·é”® `Alt + Insert â†’ Getter/Setter`

  ### ç¤ºä¾‹ï¼šç»Ÿä¸€æ˜ å°„æ–¹æ³•

  ```java
  private UserResponse toUserResponse(User user) {
      UserResponse dto = new UserResponse();
      dto.setId(user.getId());
      dto.setAccount(user.getAccount());
      dto.setUsername(user.getUsername());
      dto.setPhone(user.getPhone());
      dto.setCreateTime(user.getCreateTime());
      dto.setRole(roleToCn(user.getRole()));
      dto.setState(stateToCn(user.getState()));
      return dto;
  }
  ```

------

##  å…«ã€å¼‚å¸¸å¤„ç†ä¸æ ¡éªŒè§„èŒƒï¼ˆç»Ÿä¸€ä½¿ç”¨ `BusinessException`ï¼‰

### âœ… å¤„ç†ç›®æ ‡

- æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸ã€å‚æ•°é”™è¯¯ç»Ÿä¸€æŠ›å‡º `BusinessException`
- Controller å±‚ç»Ÿä¸€æ•è· `BusinessException`ï¼Œå¹¶è¿”å›å‰ç«¯å‹å¥½çš„ JSON å“åº”
- ä¸å†ä½¿ç”¨åŸç”Ÿ `RuntimeException` æˆ– `IllegalArgumentException`

------

### ğŸ“¦ è‡ªå®šä¹‰å¼‚å¸¸ç±»ç¤ºä¾‹

```
package com.wang.fireserver.exception;

public class BusinessException extends RuntimeException {
    private final int code;

    public BusinessException(String message) {
        super(message);
        this.code = 400;
    }

    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }

    public int getCode() {
        return code;
    }
}
```

------

### ğŸ› ï¸ Controller å±‚ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆå»ºè®®ä½¿ç”¨ `@ControllerAdvice`ï¼‰

```
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<?> handleBusinessException(BusinessException ex) {
        return ResponseEntity.badRequest().body(Map.of(
                "code", ex.getCode(),
                "message", ex.getMessage()
        ));
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<?> handleOtherExceptions(Exception ex) {
        return ResponseEntity.status(500).body(Map.of(
                "code", 500,
                "message", "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: " + ex.getMessage()
        ));
    }
}
```

------

### âœï¸ Service å±‚æŠ›å‡ºç¤ºä¾‹

```
@Transactional
public void deleteUser(List<Integer> userIds) {
    if (userIds == null || userIds.isEmpty()) {
        throw new BusinessException("ç”¨æˆ· ID åˆ—è¡¨ä¸èƒ½ä¸ºç©º");
    }

    for (Integer id : userIds) {
        User user = userRepository.findById(id)
                .orElseThrow(() -> new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨: " + id));
        user.setState("X"); // é€»è¾‘åˆ é™¤
        userRepository.save(user);
    }
}
```

## ğŸ“¦ ä¹ã€Excel å¯¼å‡ºè§„èŒƒ

- æ‰€æœ‰å¯¼å‡ºé€»è¾‘å†™åœ¨ Service å±‚
- Controller åªè°ƒç”¨å¯¼å‡ºæ–¹æ³•ï¼Œç¤ºä¾‹ï¼š

```java
@PostMapping("/exportUsers")
public void exportUsers(HttpServletResponse response) throws IOException {
    String requester = jwtUtil.getAccountFromToken(); // è‡ªå®šä¹‰æ–¹æ³•
    if (!userService.isAdmin(requester)) {
        throw new RuntimeException("æ— æƒé™");
    }
    userService.exportUsers(response);
}
```

------

## ğŸ¤– åã€AI åä½œæç¤ºæ¨¡æ¿ï¼ˆPrompt Templateï¼‰

å½“ä½ ç”¨ AI å¸®ä½ å¼€å‘ä»£ç æ—¶ï¼Œä½ å¯ä»¥ç»Ÿä¸€ç”¨ä»¥ä¸‹æç¤ºè¯­å¿«é€Ÿå»ºç«‹ä¸Šä¸‹æ–‡ï¼š

```text
æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªåŸºäº Spring Boot å’Œ MySQL çš„åç«¯é¡¹ç›®ã€‚æˆ‘åªä½¿ç”¨ Service ç±»ï¼ˆä¸å†™æ¥å£ï¼‰ï¼ŒController ä¸­åªå¤„ç†è¯·æ±‚å’Œå“åº”å°è£…ï¼Œä¸šåŠ¡é€»è¾‘å…¨éƒ¨æ”¾åœ¨ Service ç±»ä¸­ã€‚è¿”å›ç»“æ„ç»Ÿä¸€æ˜¯ ResponseEntity + Mapï¼Œåˆ†é¡µç”¨ PageRequest å’Œ PageImplã€‚æˆ‘ç”¨ BeanUtils.copyProperties æ¥å¤„ç†å®ä½“å’Œå“åº”å¯¹è±¡æ˜ å°„ã€‚å¸®æˆ‘æ ¹æ®è¿™äº›è§„èŒƒå®Œæˆ xxx åŠŸèƒ½ã€‚
```

------

## ğŸ”š åä¸€ã€Maven æ¨èä¾èµ–

```xml
<dependencies>
    <!-- Web åŸºç¡€ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- JPA -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>

    <!-- MySQL é©±åŠ¨ -->
    <dependency>
        <groupId>com.mysql</groupId>
        <artifactId>mysql-connector-j</artifactId>
    </dependency>
    
   <!-- Excel å¤„ç† -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
        <version>5.2.3</version>
    </dependency>

    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <scope>provided</scope>
    </dependency>
</dependencies>
```

------

## âœ… æ€»ç»“å…³é”®è¯ï¼ˆæ–¹ä¾¿ AI è¯†åˆ«ä½ çš„ä¹ æƒ¯ï¼‰

- Spring Boot + JPA + Lombok é¡¹ç›®ç»“æ„
- ä¸ä½¿ç”¨æ¥å£çš„ Service å±‚
- Controller åªåšå‚æ•°æ”¶å–å’Œ ResponseEntity å°è£…
- Service è´Ÿè´£æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
- BeanUtils å¤„ç†å­—æ®µæ˜ å°„
- JSON è¯·æ±‚ä½¿ç”¨ DTO Request å¯¹è±¡
- JSON å“åº”ç»Ÿä¸€åŒ…è£…ä¸º Mapï¼ˆstatus/message/dataï¼‰
- åˆ†é¡µæŸ¥è¯¢ç”¨ PageRequest + PageImpl
- Excel å¯¼å‡ºé€»è¾‘é›†ä¸­å†™åœ¨ service å±‚