# 业务模块代码生成器使用指南

## 1. 概述

业务模块代码生成器是一个自动化工具，用于快速创建符合项目规范的完整业务模块代码结构。它基于FreeMarker模板引擎，能够自动生成Entity、DTO、VO、Repository、Service和Controller等文件，大大提高开发效率。

## 2. 功能特性

- ✅ 自动创建完整的业务模块目录结构
- ✅ 生成符合项目规范的实体类（Entity）
- ✅ 生成数据传输对象（DTO）
- ✅ 生成视图对象（VO）
- ✅ 生成数据访问层（Repository）
- ✅ 生成业务逻辑层（Service接口和实现）
- ✅ 生成控制器层（Controller）
- ✅ 支持自定义配置选项
- ✅ 避免覆盖现有文件

## 3. 快速开始

### 3.1 环境要求

- JDK 17+
- Maven 3.8+（用于命令行运行）
- 项目已编译（`mvn compile`）

### 3.2 使用方法

#### 3.2.1 命令行方式

```bash
# 编译项目
mvn compile

# 运行代码生成器
mvn exec:java -Dexec.mainClass="com.example.project.generator.ModuleGenerator" -Dexec.args="模块名称 作者"
```

**示例**：生成一个名为 `order` 的模块，作者为 `admin`

```bash
mvn exec:java -Dexec.mainClass="com.example.project.generator.ModuleGenerator" -Dexec.args="order admin"
```

#### 3.2.2 IDE方式

1. 打开项目并导航到 `ModuleGenerator.java` 类
2. 修改 `main` 方法中的参数：
   ```java
   // 生成模块
   String moduleName = args.length > 0 ? args[0] : "product"; // 模块名称
   String author = args.length > 1 ? args[1] : "admin";     // 作者
   ```
3. 直接运行 `main` 方法

## 4. 生成的文件结构

运行代码生成器后，将在 `module` 目录下创建以下完整的模块结构：

```text
module/模块名称/
├── controller/              # 控制器层
│   └── 模块名称Controller.java
├── service/                 # 业务逻辑层
│   ├── 模块名称Service.java    # 接口
│   └── impl/               # 实现
│       └── 模块名称ServiceImpl.java
├── repository/             # 数据访问层
│   └── 模块名称Repository.java
└── model/                  # 模型层
    ├── entity/             # 数据库实体
    │   └── 模块名称Entity.java
    ├── dto/                # 数据传输对象
    │   └── Create模块名称DTO.java
    └── vo/                 # 视图对象
        └── 模块名称VO.java
```

## 5. 自定义配置

### 5.1 配置文件

代码生成器的配置位于 `ModuleGeneratorConfig.java` 类中，您可以根据需要修改以下配置项：

| 配置项 | 类型 | 默认值 | 描述 |
|-------|------|-------|------|
| `basePackage` | String | `com.example.project` | 项目基础包名 |       
| `moduleBasePath` | String | `src/main/java/com/example/project/module` | 模块基础路径 |
| `generateController` | boolean | `true` | 是否生成Controller |        
| `generateService` | boolean | `true` | 是否生成Service |
| `generateRepository` | boolean | `true` | 是否生成Repository |        
| `generateModel` | boolean | `true` | 是否生成Model |
| `tablePrefix` | String | `""` | 数据库表前缀 |
| `author` | String | `admin` | 默认作者 |

## 6. 问题诊断与故障排除

### 6.1 常见问题

#### 6.1.1 Maven命令无法识别
**问题**：运行`mvn`命令时提示`mvn: 无法将"mvn"项识别为 cmdlet、函数、脚本文件或可运行程序的名称`

**原因**：Maven未安装或环境变量未配置

**解决方法**：
- 检查Maven是否已安装：`mvn -version`
- 如未安装，下载并安装Maven：[Apache Maven](https://maven.apache.org/download.cgi)
- 配置环境变量：将Maven的`bin`目录添加到`PATH`环境变量

#### 6.1.2 类未找到异常
**问题**：运行代码生成器时提示`java.lang.NoClassDefFoundError: freemarker/template/TemplateException`

**原因**：项目未编译或FreeMarker依赖未正确加载

**解决方法**：
- 先执行`mvn compile`编译项目，确保依赖已下载并编译到`target/classes`目录
- 如仍有问题，执行`mvn clean compile`清理并重新编译

#### 6.1.3 文件已存在跳过生成
**问题**：运行代码生成器时输出`文件已存在，跳过: XXXX`

**原因**：目标目录中已存在同名文件，代码生成器为避免覆盖现有文件自动跳过

**解决方法**：
- 如果需要重新生成，请手动删除现有文件后再运行生成器
- 或检查是否已生成过该模块，避免重复生成

#### 6.1.4 参数错误
**问题**：运行时提示`参数错误：模块名称不能为空`

**原因**：未提供模块名称参数或参数格式错误

**解决方法**：
- 确保提供了正确的参数格式：`mvn exec:java -Dexec.mainClass="com.example.project.generator.ModuleGenerator" -Dexec.args="模块名称 作者"`
- 模块名称只能包含字母、数字和下划线

### 6.2 问题诊断方法

#### 6.2.1 查看错误日志
- 仔细阅读控制台输出的错误信息，定位问题所在
- 重点关注异常堆栈信息的第一行，通常包含问题的根本原因

#### 6.2.2 检查依赖
- 执行`mvn dependency:tree`查看项目依赖树，确保所有依赖正确加载
- 检查`pom.xml`中是否已添加FreeMarker依赖

#### 6.2.3 验证配置
- 检查`ModuleGeneratorConfig.java`中的配置是否正确
- 确保模块路径和包名符合项目结构

#### 6.2.4 检查模板文件
- 验证`src/main/resources/templates/`目录下的模板文件是否存在且格式正确
- 检查模板文件中的变量引用是否与`ModuleGenerator.java`中的数据模型一致

### 6.3 故障排除步骤

1. **环境检查**
   - 确认JDK版本：`java -version`（需JDK 17+）
   - 确认Maven版本：`mvn -version`（需Maven 3.8+）

2. **项目编译**
   - 执行`mvn compile`确保项目能正常编译
   - 如有编译错误，先解决编译问题

3. **依赖验证**
   - 执行`mvn dependency:resolve`验证依赖是否正确解析
   - 检查`target/classes`目录是否存在编译后的class文件

4. **配置检查**
   - 验证`ModuleGeneratorConfig.java`中的配置项
   - 确保`basePackage`和`moduleBasePath`与项目实际结构一致

5. **模板检查**
   - 检查模板文件是否存在：`src/main/resources/templates/entity.ftl`等
   - 验证模板文件内容是否正确

6. **重新运行**
   - 清理项目：`mvn clean`
   - 重新编译：`mvn compile`
   - 重新运行生成器

### 6.4 调试技巧

#### 6.4.1 启用调试模式
- 在IDE中设置断点，直接运行`ModuleGenerator.java`的`main`方法
- 通过调试可以逐步查看代码执行过程，定位问题所在

#### 6.4.2 打印调试信息
- 在`ModuleGenerator.java`中添加日志输出，查看变量值和执行流程
- 例如：打印生成的文件路径、数据模型内容等

```java
// 调试示例
System.out.println("生成文件路径：" + filePath);
System.out.println("数据模型：" + dataModel);
```

#### 6.4.3 检查生成的中间文件
- 查看`target/classes`目录下的模板文件是否正确加载
- 验证生成的Java文件内容是否符合预期

#### 6.4.4 手动测试模板
- 可以编写简单的测试代码，单独测试FreeMarker模板的渲染效果
- 验证模板变量是否正确替换

#### 6.4.5 检查目录权限
- 确保当前用户对生成目录有写入权限
- 在Windows系统中，检查是否以管理员身份运行命令提示符

## 7. 版本历史

### v1.0.0 (2024-01-01)
- 初始版本发布
- 支持基本的业务模块代码生成
- 包含Entity、DTO、VO、Repository、Service、Controller等文件生成
- 支持自定义配置选项

## 8. 许可证

本项目采用MIT许可证，详情请参考LICENSE文件。

## 9. 联系方式

如有问题或建议，请联系项目维护人员：admin@example.com